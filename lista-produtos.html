<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartBiz - Lista de Produtos</title>
    <link rel="stylesheet" href="header.css">
    <link rel="stylesheet" href="lista-produtos.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-content">
            <div class="loading-logo">
                <div class="loading-dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
                <div class="loading-text">SmartBiz</div>
            </div>
            <div class="loading-progress"><div class="progress-bar"></div></div>
        </div>
    </div>

    <!-- Main Content -->
    <div id="mainContent" class="hidden">
        <!-- Header -->
        <header class="header" id="header">
            <div class="header-background"></div>
            <div class="header-container">
                <div class="logo-section">
                    <div class="logo-wrapper">
                        <div class="logo-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                            </svg>
                        </div>
                        <div class="logo-content">
                            <div class="logo-title">SmartBiz</div>
                            <div class="logo-subtitle">Point of Sale</div>
                        </div>
                    </div>
                </div>

                <nav class="nav-menu" id="navMenu">
                    <div class="nav-indicator"></div>
                </nav>

                <div class="user-section">
                    <div class="notifications" data-count="3">
                        <div class="notification-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg></div>
                    </div>
                    <div class="search-trigger">
                        <div class="search-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg></div>
                    </div>
                    <div class="user-info" id="userInfo">
                        <div class="user-avatar" id="userAvatar">
                            <div class="avatar-ring"></div>
                            <span class="avatar-text">U</span>
                        </div>
                        <div class="user-details">
                            <div class="user-name" id="userName">Usuário</div>
                            <div class="user-status">Online</div>
                        </div>
                        <div class="user-menu-trigger"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M6 9l6 6 6-6"/></svg></div>
                    </div>
                    <div class="user-dropdown" id="userDropdown">
                        <div class="dropdown-header">
                            <div class="dropdown-avatar"><span id="dropdownAvatar">U</span></div>
                            <div class="dropdown-info">
                                <div class="dropdown-name" id="dropdownName">Usuário</div>
                                <div class="dropdown-email" id="dropdownEmail">usuario@email.com</div>
                            </div>
                        </div>
                        <div class="dropdown-divider"></div>
                        <div class="dropdown-menu">
                            <a href="#" class="dropdown-item"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>Perfil</a>
                            <a href="#" class="dropdown-item logout" id="logoutBtn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16,17 21,12 16,7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>Sair</a>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Page Content -->
        <main class="main-container">
            <!-- Page Header -->
            <div class="page-header">
                <div class="page-header-content">
                    <div class="page-info">
                        <div class="page-breadcrumb">
                            <span class="breadcrumb-item">Estoque</span>
                            <svg class="breadcrumb-separator" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
                            <span class="breadcrumb-item current">Lista de Produtos</span>
                        </div>
                        <h1 class="page-title">
                            <div class="title-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01"/>
                                </svg>
                            </div>
                            Lista de Produtos
                            <div class="products-counter">
                                <span id="productsCount">-</span> produtos
                            </div>
                        </h1>
                    </div>
                    <div class="page-actions">
                        <button class="btn-minimal" onclick="location.href='cadastro_produto.html'">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M12 5v14m-7-7h14"/>
                            </svg>
                            <span>Novo Produto</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Products Table -->
            <div class="table-container">
                <div class="table-header">
                    <div class="table-info">
                        <div class="results-count">
                            Mostrando <span id="showingCount">0</span> de <span id="totalCount">0</span> produtos
                        </div>
                        <div class="table-actions">
                            <button class="icon-btn" onclick="openFilterModal()" title="Filtros">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>
                                </svg>
                                <span class="filter-badge" id="activeFiltersCount" style="display: none;">0</span>
                            </button>
                            <button class="icon-btn" onclick="refreshData()" title="Atualizar">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M21.5 2v6h-6M2.5 22v-6h6M2 12a10 10 0 0 1 18.8-4.8M22 12a10 10 0 0 1-18.8 4.8"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Loading State -->
                <div class="loading-state" id="loadingState">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">Carregando produtos...</div>
                </div>

                <!-- Empty State -->
                <div class="empty-state hidden" id="emptyState">
                    <div class="empty-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <rect x="3" y="3" width="18" height="18" rx="2"/>
                            <path d="M9 9h6v6H9z"/>
                        </svg>
                    </div>
                    <div class="empty-title">Nenhum produto encontrado</div>
                    <div class="empty-subtitle">Tente ajustar os filtros ou cadastre novos produtos</div>
                    <button class="btn-minimal" onclick="location.href='cadastro_produto.html'">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M12 5v14m-7-7h14"/>
                        </svg>
                        <span>Cadastrar Primeiro Produto</span>
                    </button>
                </div>

                <!-- Table View -->
                <div class="table-view" id="tableView">
                    <div class="table-wrapper">
                        <table class="products-table" id="productsTable">
                            <thead>
                                <tr>
                                    <th class="sortable" data-sort="descricao">
                                        Produto
                                        <svg class="sort-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                            <path d="M8 9l4-4 4 4M16 15l-4 4-4-4"/>
                                        </svg>
                                    </th>
                                    <th class="sortable" data-sort="categoria">
                                        Categoria
                                        <svg class="sort-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                            <path d="M8 9l4-4 4 4M16 15l-4 4-4-4"/>
                                        </svg>
                                    </th>
                                    <th class="sortable" data-sort="quantidade">
                                        Quantidade
                                        <svg class="sort-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                            <path d="M8 9l4-4 4 4M16 15l-4 4-4-4"/>
                                        </svg>
                                    </th>
                                    <th class="sortable" data-sort="preco">
                                        Preço Venda
                                        <svg class="sort-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                            <path d="M8 9l4-4 4 4M16 15l-4 4-4-4"/>
                                        </svg>
                                    </th>
                                    <th class="sortable" data-sort="total">
                                        Valor Total
                                        <svg class="sort-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                            <path d="M8 9l4-4 4 4M16 15l-4 4-4-4"/>
                                        </svg>
                                    </th>
                                    <th class="actions-header">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="productsTableBody">
                                <!-- Products will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pagination -->
                <div class="pagination-container" id="paginationContainer">
                    <div class="pagination-info">
                        <span id="paginationInfo">Página 1 de 1</span>
                    </div>
                    <div class="pagination-controls">
                        <button class="pagination-btn" id="prevPageBtn" onclick="changePage(-1)" disabled>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M15 18l-6-6 6-6"/>
                            </svg>
                            Anterior
                        </button>
                        <div class="pagination-pages" id="paginationPages">
                            <!-- Page numbers will be generated here -->
                        </div>
                        <button class="pagination-btn" id="nextPageBtn" onclick="changePage(1)" disabled>
                            Próxima
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M9 18l6-6-6-6"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Filter Modal -->
    <div class="modal-overlay" id="filterModal">
        <div class="modal-container filter-modal">
            <div class="modal-header">
                <div class="modal-title">
                    <svg class="modal-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>
                    </svg>
                    <span>Filtros</span>
                </div>
                <button class="close-modal" onclick="closeFilterModal()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-content">
                <div class="filters-grid">
                    <div class="filter-group">
                        <label>Buscar por Nome</label>
                        <div class="search-input-container">
                            <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="m21 21-4.35-4.35"/>
                            </svg>
                            <input type="text" id="searchInput" placeholder="Digite o nome do produto..." class="filter-input">
                        </div>
                    </div>
                    <div class="filter-group">
                        <label>Categoria</label>
                        <select id="categoryFilter" class="filter-select">
                            <option value="">Todas as categorias</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Faixa de Preço</label>
                        <div class="price-range">
                            <input type="text" id="minPrice" placeholder="Mín" class="filter-input price-input">
                            <span class="range-separator">até</span>
                            <input type="text" id="maxPrice" placeholder="Máx" class="filter-input price-input">
                        </div>
                    </div>
                    <div class="filter-group">
                        <label>Estoque</label>
                        <select id="stockFilter" class="filter-select">
                            <option value="">Todos</option>
                            <option value="low">Estoque baixo</option>
                            <option value="zero">Sem estoque</option>
                            <option value="available">Com estoque</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Ordenar por</label>
                        <select id="sortFilter" class="filter-select">
                            <option value="descricao">Nome (A-Z)</option>
                            <option value="descricao_desc">Nome (Z-A)</option>
                            <option value="preco">Menor preço</option>
                            <option value="preco_desc">Maior preço</option>
                            <option value="quantidade">Menor estoque</option>
                            <option value="quantidade_desc">Maior estoque</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="clearAllFilters()">Limpar Filtros</button>
                <button class="btn-primary" onclick="applyFilters()">Aplicar</button>
            </div>
        </div>
    </div>

    <!-- Product View/Edit Modal -->
    <div class="modal-overlay" id="productModal">
        <div class="modal-container">
            <div class="modal-header">
                <div class="modal-title">
                    <div class="modal-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 7h16l-1 10a2 2 0 0 1-2 1.87H7a2 2 0 0 1-2-1.87L4 7ZM4 7l-1-3h3l1 3"/>
                        </svg>
                    </div>
                    <span id="modalTitle">Detalhes do Produto</span>
                </div>
                <button class="close-modal" onclick="closeProductModal()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-content">
                <div id="modalBody">
                    <!-- Product details will be loaded here -->
                </div>
            </div>
            <div class="modal-actions" id="modalActions">
                <button class="btn-secondary" onclick="closeProductModal()">Fechar</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js"></script>
    <script src="header.js"></script>
    <script src="lista-produtos.js"></script>
    <script src="lista-modal.js"></script>
    <script src="lista-supa.js"></script>
</body>
</html>